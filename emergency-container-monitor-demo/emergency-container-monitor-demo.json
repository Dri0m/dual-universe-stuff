{"slots":{"0":{"name":"screen","type":{"events":[],"methods":[]}},"1":{"name":"c1","type":{"events":[],"methods":[]}},"2":{"name":"c2","type":{"events":[],"methods":[]}},"3":{"name":"c3","type":{"events":[],"methods":[]}},"4":{"name":"c4","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-2":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"c1Resp = c1.getItemsList()\n\nsystem.print(string.format(\"C1: %s\", c1Resp))\ncontainerReadyCounter = containerReadyCounter + 1\n\nif containerReadyCounter == 4 then\n    generateApplyHTML()\nend","filter":{"args":[],"signature":"storageAcquired()","slotKey":"1"},"key":"0"},{"code":"c2Resp = c2.getItemsList()\n\nsystem.print(string.format(\"C2: %s\", c2Resp))\ncontainerReadyCounter = containerReadyCounter + 1\n\nif containerReadyCounter == 4 then\n    generateApplyHTML()\nend","filter":{"args":[],"signature":"storageAcquired()","slotKey":"2"},"key":"1"},{"code":"c3Resp = c3.getItemsList()\n\nsystem.print(string.format(\"C3: %s\", c3Resp))\ncontainerReadyCounter = containerReadyCounter + 1\n\nif containerReadyCounter == 4 then\n    generateApplyHTML()\nend","filter":{"args":[],"signature":"storageAcquired()","slotKey":"3"},"key":"2"},{"code":"c4Resp = c4.getItemsList()\n\nsystem.print(string.format(\"C4: %s\", c4Resp))\ncontainerReadyCounter = containerReadyCounter + 1\n\nif containerReadyCounter == 4 then\n    generateApplyHTML()\nend","filter":{"args":[],"signature":"storageAcquired()","slotKey":"4"},"key":"3"},{"code":"screen.setCenteredText(\"Emergency container monitor\")","filter":{"args":[],"signature":"stop()","slotKey":"-1"},"key":"4"},{"code":"-- describe your containers, e.g. their location\nlocal c1Name = \"Lobby\"\nlocal c2Name = \"Bridge\"\nlocal c3Name = \"Core Room\"\nlocal c4Name = \"Atmo Tanks\"\n\n-- use item class, not item name, case sensitive!\nlocal demands = {\n    CalciumScrap=500,\n    LithiumScrap=200,\n    CobaltScrap=50,\n}\n\n-- do not modify below\n\nc1.acquireStorage()\nc2.acquireStorage()\nc3.acquireStorage()\nc4.acquireStorage()\n\ncontainerReadyCounter = 0\nc1Resp = nil\nc2Resp = nil\nc3Resp = nil\nc4Resp = nil\n\n\nlocal function makeDeltaList()\n    local result = {}\n    for k,v in pairs(demands) do\n        result[k] = v\n    end\n    return result\nend\n\nlocal function missingItemsToHTML(data)\n    local result = \"\"\n    for k, v in pairs(data) do\n        if v > 0 then\n            result = result .. string.format(\"%s: %d<br>\", k, v)\n        end\n    end\n    \n    -- i don't know what 'single responsibility' is mate\n    local class = \"ok\"\n    if result ~= \"\" then\n        class = \"nok\"\n        result = \"Missing items!<br>\" .. result\n    end\n    if result == \"\" then\n        result = \"All OK!<br>\"\n    end\n    return result, class\n    \nend\n\nlocal function computeDeltaList(resp)\n    deltaList = makeDeltaList()\n    local data = json.decode(resp)\n    \n    for i,item in ipairs(data) do\n        local itemClass = item[\"class\"]\n        local itemQuanity = item[\"quantity\"]\n        \n        for demandClass, demandQuantity in pairs(demands) do\n            if itemClass == demandClass then\n                deltaList[itemClass] = demandQuantity - itemQuanity\n            end\n        end\n    end\n    \n    return deltaList\nend\n\nfunction generateApplyHTML()\n    local c1Items, c1Class = missingItemsToHTML(computeDeltaList(c1Resp))\n    local c2Items, c2Class = missingItemsToHTML(computeDeltaList(c2Resp))\n    local c3Items, c3Class = missingItemsToHTML(computeDeltaList(c3Resp))\n    local c4Items, c4Class = missingItemsToHTML(computeDeltaList(c4Resp))\n    \n    local c1String = string.format(\"<td class='%s'>Container A - %s<br>%s</td>\", c1Class, c1Name, c1Items)\n    local c2String = string.format(\"<td class='%s'>Container B - %s<br>%s</td>\", c2Class, c2Name, c2Items)\n    local c3String = string.format(\"<td class='%s'>Container C - %s<br>%s</td>\", c3Class, c3Name, c3Items)\n    local c4String = string.format(\"<td class='%s'>Container D - %s<br>%s</td>\", c4Class, c4Name, c4Items)\n    \n    screen.setHTML([[\n    <style type=\"text/css\">\n        table {\n            border-collapse: collapse;\n            border-spacing: 0;\n            border: 4px solid grey;\n            text-transform: uppercase;\n            width: 100%;\n            height: 100%;\n        }\n\n        tr,\n        td,\n        th {\n            border: 2px solid white;\n            vertical-align: center;\n            text-align: center;\n            font-size: 150%;\n            font-family: monospace;\n        }\n\n        .ok {\n            background-color: green;\n            color: white;\n            text-transform: none;\n            font-family: monospace;\n            text-transform: none;\n            font-weight: bold;\n        }\n\n        .nok {\n            background-color: red;\n            color: white;\n            font-family: monospace;\n            text-transform: none;\n            font-weight: bold;\n        }\n    </style>\n    ]] .. string.format([[\n    <table>\n        <tbody>\n            <tr>\n                %s %s\n            </tr>\n            <tr>\n                %s %s\n            </tr>\n        </tbody>\n    </table>\n    ]], c1String, c2String, c3String, c4String))\nend","filter":{"args":[],"signature":"start()","slotKey":"-1"},"key":"5"}],"methods":[],"events":[]}